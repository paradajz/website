<!DOCTYPE html> <html lang="zxx"> <head> <!-- meta --> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="description" content=""> <meta name="keywords" content=""> <!-- Facebook Open Graph --> <meta content="Shantea Controls" property="og:site_name"> <meta property="og:locale" content="en_US"> <meta content="Marching forward with OpenDeck: The hardware" property="og:title"> <meta content="article" property="og:type"> <meta content="" property="og:description"> <meta content="https://shanteacontrols.com/2015/10/26/marching-forward-with-opendeck-the-hardware/" property="og:url"> <meta content="eagleup_opendeck-r1_board_top.png" property="og:image"> <meta content="opendeck" property="article:tag"> <meta content="2015-10-26T00:00:00+00:00" property="article:published_time"> <!-- Twitter cards --> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Marching forward with OpenDeck: The hardware"> <meta name="twitter:description" content=""> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://shanteacontrols.comeagleup_opendeck-r1_board_top.png"> <!-- Site Title --> <title> Marching forward with OpenDeck: The hardware &#8226 Shantea Controls Blog </title> <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"> <!-- gulp:css --> <link rel="stylesheet" href="/css/blog/app.css"> <!-- endgulp --> <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet"> </head> <nav class="navbar navbar-default fixed-top"> <div class="container-fluid"> <div class="navbar-header"> <a href="/blog/blog.html"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/> <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/> </svg> </a> <a href="/pages/tags/"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-hash" viewBox="0 0 16 16"> <path d="M8.39 12.648a1.32 1.32 0 0 0-.015.18c0 .305.21.508.5.508.266 0 .492-.172.555-.477l.554-2.703h1.204c.421 0 .617-.234.617-.547 0-.312-.188-.53-.617-.53h-.985l.516-2.524h1.265c.43 0 .618-.227.618-.547 0-.313-.188-.524-.618-.524h-1.046l.476-2.304a1.06 1.06 0 0 0 .016-.164.51.51 0 0 0-.516-.516.54.54 0 0 0-.539.43l-.523 2.554H7.617l.477-2.304c.008-.04.015-.118.015-.164a.512.512 0 0 0-.523-.516.539.539 0 0 0-.531.43L6.53 5.484H5.414c-.43 0-.617.22-.617.532 0 .312.187.539.617.539h.906l-.515 2.523H4.609c-.421 0-.609.219-.609.531 0 .313.188.547.61.547h.976l-.516 2.492c-.008.04-.015.125-.015.18 0 .305.21.508.5.508.265 0 .492-.172.554-.477l.555-2.703h2.242l-.515 2.492zm-1-6.109h2.266l-.515 2.563H6.859l.532-2.563z"/> </svg> </a>  </div> </div> </nav> <body class="post-template"> <div class="page-header grey-bg mt-5 pb-100 mb-100 pt-85 clearfix"> <div class="container"> <div class="row"> <div class="col"> <div class="author-text"> <div class="single-author-d w-100"> <div class="title"> <h2 class="mb-0 text-center">Marching forward with OpenDeck: The hardware</h2> </div> <div class="post-meta d-flex"> <ul class="post-sp-meta list-inline mx-auto my-0"> <li class="list-inline-item"> <i class="fa fa-clock-o"></i>26 October 2015 </li> </ul> </div> </div> </div> </div> </div> </div> </div> <div class="post-content-area pb-100 clearfix"> <div class="container"> <div class="row"> <div class="col-lg-10 mx-auto"> <div class="s-post-details"> <div class="post-image mb-4"> <img class="mx-auto d-block" src="/images/blog/eagleup_opendeck-r1_board_top.png" alt="Marching forward with OpenDeck: The hardware"> </div> <div class="entry-content"><p>This post will shed some light on the development of OpenDeck platform, since it’s been quite some time I’ve done any updates on this project. Don’t let the silence fool you - project is very active.</p> <p>For those who don’t know what OpenDeck is (there are couple of posts about it on this site) - it’s a MIDI platform designed to relieve you of doing tedious stuff in the build-process of a MIDI controller. Those who want to build their own controllers quickly find out that it’s not really a small thing to accomplish, even if there are some great platforms out there which can make the job much easier, such as Teensy or Arduino. You need to know how to write code, choose the right hardware, install software development tools on your computer, deal with all kinds of errors (both hardware and software) etc. OpenDeck allows you to forget about all of that. It’s a system which allows you to pick basic components of your MIDI controller - such as potentiometers, buttons, encoders, LEDs etc. - plug them into the OpenDeck board, and actually use them in your MIDI controller in a matter of minutes. Neat, right? So, how does it work? I’m going to talk about it in a couple of posts, since the project has several layers. In this one, I’ll try to do a hardware architecture breakdown of the project.</p> <h2 id="the-board">The board</h2> <p>The board is 10x10cm in size. It’s 1.6mm thick and the current color is green. It has four M2 mounting holes, one in each corner. I don’t have pictures of the board since I’m currently waiting for it to arrive from ITead studio, but here’s render of front and back (the holes in the corners are not displayed):</p> <p><img src="/images/blog/eagleup_opendeck-r1_board_top.png" alt=""></p> <p><img src="/images/blog/eagleup_opendeck-r1_board_bottom.png" alt=""></p> <h2 id="specifications">Specifications</h2> <p>You can connect various components which are the building blocks of your MIDI controller into OpenDeck board. It allows you to connect:</p> <ol> <li>64 buttons or 32 encoders max (one encoder is kinda like having two buttons)</li> <li>32 potentiometers or FSRs (force-sensitive resistors) - support for other analog sensors is planned as well</li> <li>48 single color or 16 RGB LEDs</li> </ol> <p>The board also contains DIN MIDI in and out ports. MIDI in port can be used in two ways:</p> <ol> <li>MIDI to USB converter, allowing you to receive data from MIDI gear and translate it to USB MIDI to control your MIDI software on a computer</li> <li>LED control, allowing you to receive data from MIDI gear and control LEDs connected to OpenDeck board.</li> </ol> <h3 id="power">Power</h3> <p>The board has only one power connector - USB (B type). Board can be used either using computer or standalone, in which case USB wall charger is required - any one will do, as long as it meets USB power spec (5V/500mA).</p> <h3 id="esd-protection">ESD protection</h3> <p>USB data and voltage lines have <a href="http://www.nxp.com/documents/data_sheet/PRTR5V0U2X.pdf">ESD protection diodes</a>. There’s a nice article on electro-static discharge on <a href="https://en.wikipedia.org/wiki/Electrostatic_discharge">Wikipedia</a>.</p> <h3 id="indicator-leds">Indicator LEDs</h3> <p>There are two LEDs on board - power and bootloader LEDs. Power LED is constantly on when board is powered on, while bootloader LED is only active when firmware update is in progress.</p> <h3 id="microcontroller">Microcontroller</h3> <p>The brain of OpenDeck board is same microcontroller used in Arduino Leonardo and Teensy 2.0 - Atmel ATmega 32u4. That little microcontroller has USB hardware built right into the chip which allows your computer to recognize it as generic MIDI device, so that there are no drivers required on any major platform (Linux, Mac OS X, Windows).</p> <h3 id="buttonencoder-hardware">Button/encoder hardware</h3> <p>In order to read buttons and encoders, a matrix setup is used. There are 8 input rows controlled by <a href="http://www.nxp.com/documents/data_sheet/74HC_HCT165.pdf">74HC165</a> shift register and 8 columns controlled by <a href="http://www.nxp.com/documents/data_sheet/74HC_HCT238.pdf">74HC238</a> decoder. Matrix uses column-switching to read data and there is only one active column at time during which all 8 rows are being read. There is more info on how button (and LED) matrix works on this <a href="http://pcbheaven.com/wikipages/How_Key_Matrices_Works/">link</a>.</p> <h3 id="led-hardware">LED hardware</h3> <p>LED setup also uses matrix. It has 6 rows and 8 columns. Driving LED matrix directly from microcontroller is generally un-advisable, since the microcontroller isn’t really meant to be current source (or sink) so its capabilities are quite limited in that regard. Matrix can draw a lot of current, so if not careful, you can easily damage the microcontroller. In order to solve this, several components are used:</p> <ol> <li>LED hardware uses dedicated voltage regulator, <a href="http://www.ti.com/lit/ds/symlink/lp2985-n.pdf">LP2985-N</a>. Regulator outputs stable 4V.</li> <li>Each LED row has a <a href="https://www.fairchildsemi.com/datasheets/FD/FDC6312P.pdf">MOSFET transistor</a> which turns the row on or off, triggered by a state of digital pin on microcontroller. This way, very little current is required to turn the MOSFET on, and when it is on, transistor draws the current from 4V voltage regulator instead of microcontroller, and feeds it into LED.</li> <li>Each column is connected to <a href="http://www.ti.com/lit/ds/symlink/uln2803a.pdf">ULN2803</a> current sink, since 6 rows of LEDs can generate about 200mA of current and absolute maximum microcontroller can handle is 40mA.</li> <li>Current sink inputs are connected to another <a href="http://www.nxp.com/documents/data_sheet/74HC_HCT238.pdf">74HC238</a> decoder so that only 3 pins are required to handle column switching instead of 8.</li> </ol> <p>The big question here was which resistors to choose for LED rows. In order to achieve full brightness, most LEDs require 20mA of current. In matrix, LEDs get switched on and off very fast without you noticing it. Current flawing through LEDs in matrix is called “pulse” current, since it flaws for a very short period of time. If you would pick a resistor for 20mA of current in LED matrix, you would notice that LED isn’t really set to maximum brightness, since the current is actually lower. Because of this, we will calculate the value of resistor to achieve 30mA of current. Another problem rises here: each color of LED has different voltage drop. For instance, red LED usually has voltage drop around 1.7V. Green has around 2.2V. In order to select resistor value, I took the average voltage drop for most popular colors, based on <a href="http://stompville.co.uk/wp-content/uploads/2012/02/103SV.png">this table</a>. The average drop is 2.3V. For 30mA current, 4V voltage source and 2.3V of voltage drop, a resistor value of 56 ohms is chosen. Since this calculation is based on average voltage drop, the current will vary depending on chosen color.</p> <h3 id="analog-hardware">Analog hardware</h3> <p>For analog components to work reliably, stable voltage is absolutely required. Like LED hardware, analog part of the board also has dedicated 3.3V voltage regulator, <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/22056b.pdf">MCP1825</a>. To read values from 32 analog components, two <a href="http://www.ti.com/lit/ds/symlink/cd74hc4067.pdf">4067</a> analog multiplexers are used.</p> <h3 id="midi-hardware">MIDI hardware</h3> <p>MIDI in hardware requires the use of opto-coupler - I’ve selected <a href="http://www.vishay.com/docs/83605/6n138.pdf">6N138</a> as recommended on MIDIbox forums and official MIDI documentation. MIDI out circuit is the same as recommended on <a href="https://www.pjrc.com/teensy/td_libs_MIDI.html">Teensy web site</a>.</p> <p>That would be all in this post - in the next one I’ll talk about the software running on the board.</p> </div> <div class="inner-padding fullwidth pb-60"> <div class="post-share-icon clearfix"> <div class="tag-list"> <div class="row"> <div class="col-md-8"> <p class="float-left pr-2"><strong>Tags :</strong></p> <ul class="float-left"> <li> <a href="/tag/opendeck/blog.html"> #opendeck</a> </li> </ul> </div> <div class="col-md-4"></div> </div> </div> </div> </div> </div> <div class="categories-carousel pb-60 clearfix"> <div class="section-title"> <h3>Related Posts</h3> </div> <div class="related-post-carousel owl-carousel"> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/cover_opendeck_v6.jpg" alt="OpenDeck v6 - what comes next?"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2021/11/23/opendeck-6-what-comes-next/">OpenDeck v6 - what comes next?</a> </h3> <div class="btn-read"> <a href="/2021/11/23/opendeck-6-what-comes-next/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/blackpill411.jpg" alt="Support for new hardware"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/11/19/support-for-new-hardware/">Support for new hardware</a> </h3> <div class="btn-read"> <a href="/2020/11/19/support-for-new-hardware/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/11/11/opendeck-v2-boards-now-available/">OpenDeck v2 boards now available</a> </h3> <div class="btn-read"> <a href="/2020/11/11/opendeck-v2-boards-now-available/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/IMG_3135_web.jpg" alt="New firmware, new boards, new controllers"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/10/12/new-firmware-new-boards-new-controllers/">New firmware, new boards, new controllers</a> </h3> <div class="btn-read"> <a href="/2020/10/12/new-firmware-new-boards-new-controllers/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/06/11/creating-custom-opendeck-board-variants/">Creating custom OpenDeck board variants</a> </h3> <div class="btn-read"> <a href="/2020/06/11/creating-custom-opendeck-board-variants/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/stm32f4discovery.jpg" alt="OpenDeck on ARM"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/02/27/opendeck-on-arm/">OpenDeck on ARM</a> </h3> <div class="btn-read"> <a href="/2020/02/27/opendeck-on-arm/">Read More</a> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <footer> <div class="footer-area clearfix"> <div class="container"> <div class="row"> <div class="col-lg-12"> <div class="footer-logo pb-100 pt-100 text-center"> <a href="https://shanteacontrols.com"> <img src="/images/logo_notext_inv.svg" alt="Shantea Controls"> </a> </div> </div> </div> <div class="row pb-60"> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> About </h4> </div> <div class="widget-text"> <p>Shantea Controls Blog</p> <div class="social-link"> <ul> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4>Recent posts</h4> </div> <div class="widget-text"> <div class="r-post"> <ul> <li><a href="/2021/11/23/opendeck-6-what-comes-next/">OpenDeck v6 - what comes next? </a> </li> <li><a href="/2021/06/04/the-new-dubfocus-controller/">The new DubFocus controller </a> </li> <li><a href="/2021/03/30/regarding-dubfocus/">Regarding DubFocus </a> </li> <li><a href="/2021/02/18/the-touchscreen-trio/">The touchscreen trio </a> </li> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> Links</h4> </div> <div class="widget-text"> <div class="widget-link"> <ul> <ul> <li><a href="/" target="_blank">Main page</a></li> <li><a href="https://youtube.com/shanteacontrols" target="_blank">YouTube</a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank">Facebook</a></li> <li><a href="https://github.com/shanteacontrols/OpenDeck" target="_blank">GitHub</a></li> </ul> </ul></div> </div> </div> </div> </div> <div class="row"> <div class="col"> <div class="footer-text text-center"> <p class="footer-address"> &copy; 2022 Shantea Controls | Developed by <a href="https://themeix.com">themeix</a></p> </div> </div> </div> </div> </div> </footer> <script src="/js/blog/build.js"></script> </body> </html> 