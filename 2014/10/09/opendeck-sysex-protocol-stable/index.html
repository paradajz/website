<!DOCTYPE html> <html lang="zxx"> <head> <!-- meta --> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="description" content=""> <meta name="keywords" content=""> <!-- Facebook Open Graph --> <meta content="Shantea Controls" property="og:site_name"> <meta property="og:locale" content="en_US"> <meta content="OpenDeck SysEx protocol - stable!" property="og:title"> <meta content="article" property="og:type"> <meta content="" property="og:description"> <meta content="https://shanteacontrols.com/2014/10/09/opendeck-sysex-protocol-stable/" property="og:url"> <meta content="" property="og:image"> <meta content="opendeck" property="article:tag"> <meta content="programming" property="article:tag"> <meta content="2014-10-09T00:00:00+00:00" property="article:published_time"> <!-- Twitter cards --> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="OpenDeck SysEx protocol - stable!"> <meta name="twitter:description" content=""> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content=""> <!-- Site Title --> <title> OpenDeck SysEx protocol - stable! &#8226 Shantea Controls Blog </title> <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"> <!-- gulp:css --> <link rel="stylesheet" href="/css/blog/app.css"> <!-- endgulp --> <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet"> </head> <nav class="navbar navbar-default fixed-top"> <div class="container-fluid"> <div class="navbar-header"> <a href="/blog/blog.html"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/> <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/> </svg> </a> <a href="/pages/tags/"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-hash" viewBox="0 0 16 16"> <path d="M8.39 12.648a1.32 1.32 0 0 0-.015.18c0 .305.21.508.5.508.266 0 .492-.172.555-.477l.554-2.703h1.204c.421 0 .617-.234.617-.547 0-.312-.188-.53-.617-.53h-.985l.516-2.524h1.265c.43 0 .618-.227.618-.547 0-.313-.188-.524-.618-.524h-1.046l.476-2.304a1.06 1.06 0 0 0 .016-.164.51.51 0 0 0-.516-.516.54.54 0 0 0-.539.43l-.523 2.554H7.617l.477-2.304c.008-.04.015-.118.015-.164a.512.512 0 0 0-.523-.516.539.539 0 0 0-.531.43L6.53 5.484H5.414c-.43 0-.617.22-.617.532 0 .312.187.539.617.539h.906l-.515 2.523H4.609c-.421 0-.609.219-.609.531 0 .313.188.547.61.547h.976l-.516 2.492c-.008.04-.015.125-.015.18 0 .305.21.508.5.508.265 0 .492-.172.554-.477l.555-2.703h2.242l-.515 2.492zm-1-6.109h2.266l-.515 2.563H6.859l.532-2.563z"/> </svg> </a>  </div> </div> </nav> <body class="post-template"> <div class="page-header grey-bg mt-5 pb-100 mb-100 pt-85 clearfix"> <div class="container"> <div class="row"> <div class="col"> <div class="author-text"> <div class="single-author-d w-100"> <div class="title"> <h2 class="mb-0 text-center">OpenDeck SysEx protocol - stable!</h2> </div> <div class="post-meta d-flex"> <ul class="post-sp-meta list-inline mx-auto my-0"> <li class="list-inline-item"> <i class="fa fa-clock-o"></i>09 October 2014 </li> </ul> </div> </div> </div> </div> </div> </div> </div> <div class="post-content-area pb-100 clearfix"> <div class="container"> <div class="row"> <div class="col-lg-10 mx-auto"> <div class="s-post-details"> <div class="entry-content"><p>Last time I wrote about OpenDeck SysEx protocol, there were still many unsolved problems and issues, together with lack of functionality. Since I actually released OpenDeck software on GitHub couple of days ago, it’s time to write a new post, explaining all current features, and announcing some new ones.</p> <h2 id="hello-world">Hello World</h2> <p>Back when I first wrote about SysEx protocol, I explained how SysEx programming doesn’t work until “Hello World” message has been received. That bit wasn’t implemented then, but it is now. Hello message consists of three ID bytes only (hex code):</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 F7</code></p> <p>After the message is sent to controller, it responds with those same ID bytes, and ACK at the end (<code class="language-plaintext highlighter-rouge">0x41</code>):</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 41 F7</code></p> <p>When this message is received, controller can be programmed using System Exclusive.</p> <h2 id="message-format">Message format</h2> <p>Main message format for SysEx is left untouched, as it proved efficient and reasonably easy to use:</p> <p><code class="language-plaintext highlighter-rouge">F0 ID ID ID WISH AMOUNT MESSAGE_TYPE MESSAGE_SUBTYPE PARAMETER_ID* NEW_PARAMETER_ID* F7</code></p> <p>Bytes marked with asterisk are optional, since their use depends on WISH and AMOUNT bytes.</p> <h1 id="message-types">Message types</h1> <p>Since the last post, the only things changed here are <code class="language-plaintext highlighter-rouge">MESSAGE_TYPE</code> codes:</p> <ul> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_MIDI_CHANNEL</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_HW_PARAMETER</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_FREE_PINS</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_SW_FEATURE</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_HW_FEATURE</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_BUTTON</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_POT</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_ENC</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_LED</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MT_ALL</code></li> </ul> <p>MIDI channel has code <code class="language-plaintext highlighter-rouge">0x00</code>, HW parameter <code class="language-plaintext highlighter-rouge">0x01</code>, and every next byte has next incremented value.</p> <h2 id="additions">Additions</h2> <p>Pots now have additional sub-types: lower and upper CC limit. Using those message, each pot can have defined CC range. After you define custom range, ie. 40-120, CC message won’t be “cut-off”, it will be interpolated across whole pot range instead.</p> <p>Another addition from last time is the “Free pins” message, that is, you can now configure those four free pins available on reference PCB. Due to the mistake in design, pin C can only be configured as output, since it’s connected to pin 13 on Arduino. It has nothing to do with pin 13 itself, it’s just the fact that pretty much every Arduino out there has LED and resistor connected to that pin, so using it as input is harder, but not impossible. It would require usage of some extra components, but for convenience sake I’ve decided that it can only be configured as output. Because of that, you cannot increase number of inputs to 64 (four extra rows in button matrix), but 56 instead. No big deal, but I’ll most certainly pick another pin for user configuration on next PCB design.</p> <p>Example of free pin configuration:</p> <p>Let’s set pin A as output, which will result in increase of maximum number of LEDs to 40:</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 01 00 02 00 00 02 F7</code></p> <p><code class="language-plaintext highlighter-rouge">0xF0</code> is usual SysEx message start, followed by three ID bytes. We want to configure (set) pin, so <code class="language-plaintext highlighter-rouge">WISH</code> byte is <code class="language-plaintext highlighter-rouge">0x01</code>. Since we only want to set one pin, <code class="language-plaintext highlighter-rouge">AMOUNT</code> is 0 (single). Message type for free pin message is <code class="language-plaintext highlighter-rouge">0x02</code>, with no sub-type. Pin A parameter code is <code class="language-plaintext highlighter-rouge">0x00</code>, and since we want to set it as output, new parameter code is <code class="language-plaintext highlighter-rouge">0x02</code>. Setting it to <code class="language-plaintext highlighter-rouge">0x00</code> disables it, and setting it to <code class="language-plaintext highlighter-rouge">0x01</code> would configure that pin as extra button row.</p> <p>Response from the controller is the following message:</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 01 00 02 00 41 F7</code></p> <p>Response has been also re-modeled a bit since last time. It copies everything from the original message, except the parameter and new parameter (if message wish is set, that is). It also places ACK (<code class="language-plaintext highlighter-rouge">0x41</code>) on the end of message, so that it’s easier to notice if the message has been handled properly.</p> <h2 id="data-restoration">Data restoration</h2> <p>Data restoration is now possible as well. You can use it to restore single parameter, all parameters within message type or everything back to default.</p> <p>Some examples of restoration:</p> <ul> <li>Setting button channel back to default (1): <code class="language-plaintext highlighter-rouge">F0 00 53 43 02 00 00 00 00 F7</code></li> <li>Setting all channels to default: <code class="language-plaintext highlighter-rouge">F0 00 53 43 02 01 00 00 F7</code></li> <li>Setting all pots to their default state (disabled): <code class="language-plaintext highlighter-rouge">F0 00 53 43 02 01 06 00 F7</code></li> <li>Complete factory reset: <code class="language-plaintext highlighter-rouge">F0 00 53 43 02 01 09 00 F7</code></li> </ul> <p>If the entire controller is restored to its defaults, first thing that needs to be configured is board type. Board type for OpenDeck reference board is 01, and you need to set it using the following message:</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 01 00 01 00 00 01 F7</code></p> <h2 id="led-configuration">LED configuration</h2> <p>LEDs configuration is another thing that still wasn’t possible when I wrote first SysEx post. LEDs now have several sub-types of message:</p> <ul> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MST_LED_ACT_NOTE</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MST_LED_START_UP_NUMBER</code></li> <li><code class="language-plaintext highlighter-rouge">SYS_EX_MST_LED_STATE</code></li> </ul> <p>Again, <code class="language-plaintext highlighter-rouge">LED_ACT_NOTE</code> has code <code class="language-plaintext highlighter-rouge">0x00</code>, <code class="language-plaintext highlighter-rouge">START_UP_NUMBER</code> is <code class="language-plaintext highlighter-rouge">0x01</code>, and <code class="language-plaintext highlighter-rouge">LED_STATE</code> is <code class="language-plaintext highlighter-rouge">0x02</code>. Using the first subtype it’s possible to select which MIDI note will turn on or off the LED. Start-up number is used only during the start-up routine. Since that routine deals with LEDs one-by-one, you can use that message sub-type to use any LED order you want. <code class="language-plaintext highlighter-rouge">LED_STATE</code> subtype is used to test the LEDs. You can set them to off state, constantly on, blinking and blinking off state.</p> <h3 id="start-up-routine">Start-up routine</h3> <p>Start-up routine won’t work until total number of LEDs has been specified. To set it, use the following message:</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 01 00 01 00 03 TOTAL_NUMBER_OF_LEDS F7</code></p> <p>There are currently four routines user can select for start-up:</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 01 00 01 00 05 START_UP_PATTERN F7</code></p> <p>Pattern can be anything <code class="language-plaintext highlighter-rouge">0x00</code>-<code class="language-plaintext highlighter-rouge">0x04</code>. Setting pattern to <code class="language-plaintext highlighter-rouge">0x00</code> will disable start-up routine.</p> <p>Changing the order of LEDs during start-up routine:</p> <p><code class="language-plaintext highlighter-rouge">F0 00 53 43 01 00 08 01 LED_NUMBER LED_START_UP_NUMBER F7</code></p> <h2 id="planned-features">Planned features</h2> <p>At the moment, I am adding support for encoders in OpenDeck software. Due to their unreliability, it’s really tricky to deal with them in software and getting stable values, but I’m working hard on it, and code should be finished soon.</p> <h2 id="demonstration">Demonstration</h2> <p>I recorded a video to show-off all the mentioned features:</p> <div class="videoWrapper"> <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/3T1-x4B77nw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> </div> </div> <div class="inner-padding fullwidth pb-60"> <div class="post-share-icon clearfix"> <div class="tag-list"> <div class="row"> <div class="col-md-8"> <p class="float-left pr-2"><strong>Tags :</strong></p> <ul class="float-left"> <li> <a href="/tag/opendeck/blog.html"> #opendeck</a> </li> <li> <a href="/tag/programming/blog.html"> #programming</a> </li> </ul> </div> <div class="col-md-4"></div> </div> </div> </div> </div> </div> <div class="categories-carousel pb-60 clearfix"> <div class="section-title"> <h3>Related Posts</h3> </div> <div class="related-post-carousel owl-carousel"> <div class="single-item"> <div class="categories-post-image"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2022/06/24/new-pco-features/">Using The New Program Change Offset Features In OpenDeck v7.3.0</a> </h3> <div class="btn-read"> <a href="/2022/06/24/new-pco-features/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/od3/5.png" alt="OpenDeck boards v3 now available"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2022/06/20/opendeck-boards-v3-available-now/">OpenDeck boards v3 now available</a> </h3> <div class="btn-read"> <a href="/2022/06/20/opendeck-boards-v3-available-now/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/od3/2.png" alt="OpenDeck boards v3 in development"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2022/04/09/opendeck-boards-v3-in-development/">OpenDeck boards v3 in development</a> </h3> <div class="btn-read"> <a href="/2022/04/09/opendeck-boards-v3-in-development/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/ble.png" alt="OpenDeck v7"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2022/04/09/opendeck-7/">OpenDeck v7</a> </h3> <div class="btn-read"> <a href="/2022/04/09/opendeck-7/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/cover_opendeck_v6.jpg" alt="OpenDeck v6 - what comes next?"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2021/11/23/opendeck-6-what-comes-next/">OpenDeck v6 - what comes next?</a> </h3> <div class="btn-read"> <a href="/2021/11/23/opendeck-6-what-comes-next/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/blackpill411.jpg" alt="Support for new hardware"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2020/11/19/support-for-new-hardware/">Support for new hardware</a> </h3> <div class="btn-read"> <a href="/2020/11/19/support-for-new-hardware/">Read More</a> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <footer> <div class="footer-area clearfix"> <div class="container"> <div class="row"> <div class="col-lg-12"> <div class="footer-logo pb-100 pt-100 text-center"> <a href="https://shanteacontrols.com"> <img src="/images/logo_notext_inv.svg" alt="Shantea Controls"> </a> </div> </div> </div> <div class="row pb-60"> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> About </h4> </div> <div class="widget-text"> <p>Shantea Controls Blog</p> <div class="social-link"> <ul> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4>Recent posts</h4> </div> <div class="widget-text"> <div class="r-post"> <ul> <li><a href="/2022/06/24/new-pco-features/">Using The New Program Change Offset Features In OpenDeck v7.3.0 </a> </li> <li><a href="/2022/06/20/opendeck-boards-v3-available-now/">OpenDeck boards v3 now available </a> </li> <li><a href="/2022/04/09/opendeck-boards-v3-in-development/">OpenDeck boards v3 in development </a> </li> <li><a href="/2022/04/09/opendeck-7/">OpenDeck v7 </a> </li> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> Links</h4> </div> <div class="widget-text"> <div class="widget-link"> <ul> <ul> <li><a href="/" target="_blank">Main page</a></li> <li><a href="https://youtube.com/shanteacontrols" target="_blank">YouTube</a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank">Facebook</a></li> <li><a href="https://github.com/shanteacontrols/OpenDeck" target="_blank">GitHub</a></li> </ul> </ul></div> </div> </div> </div> </div> <div class="row"> <div class="col"> <div class="footer-text text-center"> <p class="footer-address"> &copy; 2024 Shantea Controls | Developed by <a href="https://themeix.com">themeix</a></p> </div> </div> </div> </div> </div> </footer> <script src="/js/blog/build.js"></script> </body> </html> 