<!DOCTYPE html> <html lang="zxx"> <head> <!-- meta --> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="description" content=""> <meta name="keywords" content=""> <!-- Facebook Open Graph --> <meta content="Shantea Controls" property="og:site_name"> <meta property="og:locale" content="en_US"> <meta content="Building Anandamidi, part 4" property="og:title"> <meta content="article" property="og:type"> <meta content="" property="og:description"> <meta content="https://shanteacontrols.com/2014/06/25/building-anandamidi-part-4/" property="og:url"> <meta content="p6030151.jpg" property="og:image"> <meta content="anandamidi" property="article:tag"> <meta content="buildlog" property="article:tag"> <meta content="2014-06-25T00:00:00+00:00" property="article:published_time"> <!-- Twitter cards --> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Building Anandamidi, part 4"> <meta name="twitter:description" content=""> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:image" content="https://shanteacontrols.comp6030151.jpg"> <!-- Site Title --> <title> Building Anandamidi, part 4 &#8226 Shantea Controls Blog </title> <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon"> <!-- gulp:css --> <link rel="stylesheet" href="/css/blog/app.css"> <!-- endgulp --> <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600" rel="stylesheet"> </head> <nav class="navbar navbar-default fixed-top"> <div class="container-fluid"> <div class="navbar-header"> <a href="/blog/blog.html"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/> <path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/> </svg> </a> <a href="/pages/tags/"> <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-hash" viewBox="0 0 16 16"> <path d="M8.39 12.648a1.32 1.32 0 0 0-.015.18c0 .305.21.508.5.508.266 0 .492-.172.555-.477l.554-2.703h1.204c.421 0 .617-.234.617-.547 0-.312-.188-.53-.617-.53h-.985l.516-2.524h1.265c.43 0 .618-.227.618-.547 0-.313-.188-.524-.618-.524h-1.046l.476-2.304a1.06 1.06 0 0 0 .016-.164.51.51 0 0 0-.516-.516.54.54 0 0 0-.539.43l-.523 2.554H7.617l.477-2.304c.008-.04.015-.118.015-.164a.512.512 0 0 0-.523-.516.539.539 0 0 0-.531.43L6.53 5.484H5.414c-.43 0-.617.22-.617.532 0 .312.187.539.617.539h.906l-.515 2.523H4.609c-.421 0-.609.219-.609.531 0 .313.188.547.61.547h.976l-.516 2.492c-.008.04-.015.125-.015.18 0 .305.21.508.5.508.265 0 .492-.172.554-.477l.555-2.703h2.242l-.515 2.492zm-1-6.109h2.266l-.515 2.563H6.859l.532-2.563z"/> </svg> </a>  </div> </div> </nav> <body class="post-template"> <div class="page-header grey-bg mt-5 pb-100 mb-100 pt-85 clearfix"> <div class="container"> <div class="row"> <div class="col"> <div class="author-text"> <div class="single-author-d w-100"> <div class="title"> <h2 class="mb-0 text-center">Building Anandamidi, part 4</h2> </div> <div class="post-meta d-flex"> <ul class="post-sp-meta list-inline mx-auto my-0"> <li class="list-inline-item"> <i class="fa fa-clock-o"></i>25 June 2014 </li> </ul> </div> </div> </div> </div> </div> </div> </div> <div class="post-content-area pb-100 clearfix"> <div class="container"> <div class="row"> <div class="col-lg-10 mx-auto"> <div class="s-post-details"> <div class="post-image mb-4"> <img class="mx-auto d-block" src="/images/blog/p6030151.jpg" alt="Building Anandamidi, part 4"> </div> <div class="entry-content"><p>This is the last post about Anandamidi, I promise! So, in case you forgot, this is the remaining stuff to finish the controller:</p> <ol> <li>Painting the case</li> <li>Interfacing Arduino with separate USB MIDI chip on separate PCB (<a href="http://www.altmustech.com/au-123.html">Altmustech AU-123</a>)</li> </ol> <h2 id="painting-the-case">Painting the case</h2> <p>Fairly easy part. I’ve simply bought black spray for wood and sprayed the case 3-4 times. Looks really cool!</p> <p><img src="/images/blog/p6030151.jpg" alt=""></p> <p>Thing I haven’t mentioned before is the cable plate and the cable itself. I bought several of these USB cables off eBay:<img src="/images/blog/p1010041.jpg" alt=""></p> <p>I’ve cut off the mini-b part of cable and replaced it with 4 cables with female headers on them, so that I can simply plug it to USB MIDI or serial conversion board. Since just screwing that cable directly on wooden case would look rather ugly, I’ve also designed a cable plate board, made from same Gravoply board as the main plate.</p> <p><img src="/images/blog/p6050161.jpg" alt="">Much nicer, although I’m not too happy with screws on that plate (I haven’t had anything else). Right, let’s move on to #2.</p> <h2 id="usb-midi-board">USB MIDI board</h2> <p><img src="/images/blog/p1010012.jpg" alt=""></p> <p>There were more than several issues with this thing, as usual. After I received the PCBs, I asked a friend to help me solder that MIDI chip, since I’ve never soldered SMD component before, plus I don’t have necessary equipment for that job. After we soldered everything, connecting the board to PC did nothing. No errors, no anything. Checked everything few times, but I couldn’t find the error. Grrr! Since that didn’t work, I’ve decided to give the controller to the guy for whom I was building it without that board. Instead, there’s simple CP2102 serial module inside the Anandamidi at the moment. Everything is the same, except that way you need to install drivers (atleast if you’re on Windows), install virtual midi port and an app which converts serial messages from Arduino to MIDI. Couple of extra unnecessary layers, but it works without issues. After I got home, I spent few more days trying to figure out where I did mistake. Eventually, I figured I used capacitors far too large to be put in parallel with 12MHz crystal which MIDI chip needs. I bought 22µF tantalum caps, simply because the official documentation said only “22” for two crystal caps, so I assumed they meant microfarads. Did I mention how expensive tantalum caps are? Very. Tantalum caps are very expensive. Oh well. What I needed was 22pF caps, so after I bought them, suddenly everything worked. Hooray! Windows happily reported it found new USB MIDI device. Awesome. Unfortunately, issues didn’t end here.</p> <h3 id="testing-the-board">Testing the board</h3> <p>For first try, I only connected TX pin from Arduino to RX pin to that board, so I was only able to send data from Arduino to PC. It worked without any issue whatsoever, so I assumed sending MIDI data to that chip would work as well. Wrong. I’ve tried to send some MIDI messages to Arduino via that chip, only to get some gibberish values. Checked everything more than dozen of times, didn’t find anything wrong. So, I went back to reading the AU-123 documentation (after things don’t work, RTFM, right?) and noticed something interesting:</p> <p><img src="/images/blog/screenshot022.png" alt=""></p> <p>Active high? What the hell is that? Apparently, pins on microcontrollers can be either active high or active low. Active high means that HIGH signal (usually +5V) represents binary 1 and vice versa. Active low is exactly the opposite: +5V signal represents binary 0 and 0V represents binary 1. After some more investigation, I learned that USART pins on AVRs are active low, meaning that I need inverter if I want to interface them with active high signals. That was also the reason I got gibberish value on Arduino end without the inversion. Obviously, there’s more than several ways to invert digital signal. First I tried with NAND gates (74HCT00 chip) - worked! I simply connected one input of single NAND gate to +5V, and other input was the TX pin from AU-123 chip. Output from gate was inverted, so I connected it directly to Arduino RX pin. While this solution works, that chip contains 4 NAND gates and has 16 pins, and I only need one input on gate, so it’s a waste of chip. Instead, I went with transistor solution (2n2222):</p> <p><img src="/images/blog/9102.jpg" alt=""></p> <p>Really simple schematic and works just like the NAND gate solution. Finally, the MIDI USB board is fully fuctional.</p> <h2 id="controller-demo">Controller demo</h2> <p>Since everything works, here’s a video with Anandamidi, and my first controller, Tannin. Note that this was recorded before the case was painted. Enjoy.</p> <iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/B0tTqctuLCI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> </div> <div class="inner-padding fullwidth pb-60"> <div class="post-share-icon clearfix"> <div class="tag-list"> <div class="row"> <div class="col-md-8"> <p class="float-left pr-2"><strong>Tags :</strong></p> <ul class="float-left"> <li> <a href="/tag/anandamidi/blog.html"> #anandamidi</a> </li> <li> <a href="/tag/buildlog/blog.html"> #buildlog</a> </li> </ul> </div> <div class="col-md-4"></div> </div> </div> </div> </div> </div> <div class="categories-carousel pb-60 clearfix"> <div class="section-title"> <h3>Related Posts</h3> </div> <div class="related-post-carousel owl-carousel"> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/193474182_259492185848862_7612030630368761512_n.jpg" alt="The new DubFocus controller"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2021/06/04/the-new-dubfocus-controller/">The new DubFocus controller</a> </h3> <div class="btn-read"> <a href="/2021/06/04/the-new-dubfocus-controller/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/touchscreen_trio.jpg" alt="The touchscreen trio"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2021/02/18/the-touchscreen-trio/">The touchscreen trio</a> </h3> <div class="btn-read"> <a href="/2021/02/18/the-touchscreen-trio/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/5900f-67627252_159582195172459_3813637260394364928_o.jpg" alt="Building DubFocus controllers"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2019/08/06/building-dubfocus-controllers/">Building DubFocus controllers</a> </h3> <div class="btn-read"> <a href="/2019/08/06/building-dubfocus-controllers/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/98b26-bergamot_full_angle.jpg" alt="Touchscreen-based MIDI controller"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2018/10/14/bergamot-touchscreen-midi-controller/">Touchscreen-based MIDI controller</a> </h3> <div class="btn-read"> <a href="/2018/10/14/bergamot-touchscreen-midi-controller/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/540b3-20180713_080821.jpg" alt="Custom controller for Conscious Youth"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2018/07/16/conscious-youth-custom-controller/">Custom controller for Conscious Youth</a> </h3> <div class="btn-read"> <a href="/2018/07/16/conscious-youth-custom-controller/">Read More</a> </div> </div> </div> </div> </div> </div> <div class="single-item"> <div class="categories-post-image"> <img src="/images/blog/tannin_inside_finished_2.jpg" alt="Building Tannin 2"> <div class="categories-post-hover text-center"> <div class="hover-details"> <div class="post-link"> <h3> <a href="/2015/08/13/building-tannin-2/">Building Tannin 2</a> </h3> <div class="btn-read"> <a href="/2015/08/13/building-tannin-2/">Read More</a> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> </div> <footer> <div class="footer-area clearfix"> <div class="container"> <div class="row"> <div class="col-lg-12"> <div class="footer-logo pb-100 pt-100 text-center"> <a href="https://shanteacontrols.com"> <img src="/images/logo_notext_inv.svg" alt="Shantea Controls"> </a> </div> </div> </div> <div class="row pb-60"> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> About </h4> </div> <div class="widget-text"> <p>Shantea Controls Blog</p> <div class="social-link"> <ul> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4>Recent posts</h4> </div> <div class="widget-text"> <div class="r-post"> <ul> <li><a href="/2022/06/24/new-pco-features/">Using The New Program Change Offset Features In OpenDeck v7.3.0 </a> </li> <li><a href="/2022/06/20/opendeck-boards-v3-available-now/">OpenDeck boards v3 now available </a> </li> <li><a href="/2022/04/09/opendeck-boards-v3-in-development/">OpenDeck boards v3 in development </a> </li> <li><a href="/2022/04/09/opendeck-7/">OpenDeck v7 </a> </li> </ul> </div> </div> </div> </div> <div class="col-lg-3 col-md-6"> <div class="footer-widget"> <div class="widget-title"> <h4> Links</h4> </div> <div class="widget-text"> <div class="widget-link"> <ul> <ul> <li><a href="/" target="_blank">Main page</a></li> <li><a href="https://youtube.com/shanteacontrols" target="_blank">YouTube</a></li> <li><a href="https://www.facebook.com/shanteacontrolsmidi" target="_blank">Facebook</a></li> <li><a href="https://github.com/shanteacontrols/OpenDeck" target="_blank">GitHub</a></li> </ul> </ul></div> </div> </div> </div> </div> <div class="row"> <div class="col"> <div class="footer-text text-center"> <p class="footer-address"> &copy; 2024 Shantea Controls | Developed by <a href="https://themeix.com">themeix</a></p> </div> </div> </div> </div> </div> </footer> <script src="/js/blog/build.js"></script> </body> </html> 